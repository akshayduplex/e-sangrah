<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3">Site Settings</h1>
</div>

<div class="card">
    <div class="card-body">
        <form id="settingsForm" enctype="multipart/form-data">
            <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general"
                        type="button" role="tab">General</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="smtp-tab" data-bs-toggle="tab" data-bs-target="#smtp" type="button"
                        role="tab">SMTP</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="organization-tab" data-bs-toggle="tab" data-bs-target="#organization"
                        type="button" role="tab">Organization</button>
                </li>
            </ul>

            <div class="tab-content p-3" id="settingsTabContent">
                <!-- General Tab -->
                <div class="tab-pane fade show active" id="general" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Site Title</label>
                                <input type="text" class="form-control" name="site_title"
                                    value="<%= settings.site_title %>" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Meta Title</label>
                                <input type="text" class="form-control" name="meta_title"
                                    value="<%= settings.meta_title %>">
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Meta Description</label>
                        <textarea class="form-control" name="meta_description"
                            rows="3"><%= settings.meta_description %></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Logo Image</label>
                                <input type="file" class="form-control" name="logo_image" accept="image/*">
                                <% if (settings.logo_image) { %>
                                    <input type="hidden" name="existing_logo" value="<%= settings.logo_image %>">
                                    <div class="mt-2">
                                        <img src="/uploads/<%= settings.logo_image %>" height="50" class="mt-2">
                                    </div>
                                    <% } %>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Favicon Image</label>
                                <input type="file" class="form-control" name="fav_icon_image" accept="image/*">
                                <% if (settings.fav_icon_image) { %>
                                    <input type="hidden" name="existing_favicon" value="<%= settings.fav_icon_image %>">
                                    <div class="mt-2">
                                        <img src="/uploads/<%= settings.fav_icon_image %>" height="30" class="mt-2">
                                    </div>
                                    <% } %>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Currency</label>
                                <input type="text" class="form-control" name="currency"
                                    value="<%= settings.currency %>">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Time Zone</label>
                                <input type="text" class="form-control" name="time_zone"
                                    value="<%= settings.time_zone %>">
                            </div>
                        </div>
                    </div>

                    <h5 class="mt-4">Office Address</h5>
                    <hr>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label class="form-label">Address</label>
                                <input type="text" class="form-control" name="office_address"
                                    value="<%= settings.office_address %>">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control" name="office_city"
                                    value="<%= settings.office_city %>">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Latitude</label>
                                <input type="text" class="form-control" name="office_latitude"
                                    value="<%= settings.office_latitude %>">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Longitude</label>
                                <input type="text" class="form-control" name="office_longitude"
                                    value="<%= settings.office_longitude %>">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SMTP Tab -->
                <div class="tab-pane fade" id="smtp" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">SMTP Status</label>
                                <select class="form-select" name="smtp_enable_status">
                                    <option value="enabled" <%=settings.smtp_enable_status==='enabled' ? 'selected' : ''
                                        %>>Enabled</option>
                                    <option value="disabled" <%=settings.smtp_enable_status==='disabled' ? 'selected'
                                        : '' %>>Disabled</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">SMS Status</label>
                                <select class="form-select" name="sms_enable_status">
                                    <option value="enabled" <%=settings.sms_enable_status==='enabled' ? 'selected' : ''
                                        %>>Enabled</option>
                                    <option value="disabled" <%=settings.sms_enable_status==='disabled' ? 'selected'
                                        : '' %>>Disabled</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">SMTP Host</label>
                                <input type="text" class="form-control" name="smtp_host"
                                    value="<%= settings.smtp_host %>">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">SMTP Port</label>
                                <input type="text" class="form-control" name="smtp_port"
                                    value="<%= settings.smtp_port %>">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">SMTP Username</label>
                                <input type="text" class="form-control" name="smtp_username"
                                    value="<%= settings.smtp_username %>">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">SMTP Password</label>
                                <input type="password" class="form-control" name="smtp_password"
                                    value="<%= settings.smtp_password %>">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">From Email</label>
                                <input type="email" class="form-control" name="smtp_from_mail"
                                    value="<%= settings.smtp_from_mail %>">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Reply To Email</label>
                                <input type="email" class="form-control" name="smtp_reply_mail"
                                    value="<%= settings.smtp_reply_mail %>">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Email Content Type</label>
                                <select class="form-select" name="smtp_email_content_type">
                                    <option value="HTML" <%=settings.smtp_email_content_type==='HTML' ? 'selected' : ''
                                        %>>HTML</option>
                                    <option value="Text" <%=settings.smtp_email_content_type==='Text' ? 'selected' : ''
                                        %>>Text</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Encryption Type</label>
                                <select class="form-select" name="smtp_encryption_type">
                                    <option value="SSL" <%=settings.smtp_encryption_type==='SSL' ? 'selected' : '' %>
                                        >SSL</option>
                                    <option value="TLS" <%=settings.smtp_encryption_type==='TLS' ? 'selected' : '' %>
                                        >TLS</option>
                                    <option value="None" <%=settings.smtp_encryption_type==='None' ? 'selected' : '' %>
                                        >None</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Organization Tab -->
                <div class="tab-pane fade" id="organization" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Organization Name</label>
                                <input type="text" class="form-control" name="organization_name"
                                    value="<%= settings.organization_name %>">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Organization Email</label>
                                <input type="email" class="form-control" name="organization_email_id"
                                    value="<%= settings.organization_email_id %>">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Organization Mobile</label>
                                <input type="text" class="form-control" name="organization_mobile_no"
                                    value="<%= settings.organization_mobile_no %>">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Organization WhatsApp</label>
                                <input type="text" class="form-control" name="organization_whatsapp_no"
                                    value="<%= settings.organization_whatsapp_no %>">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Job Portal Link</label>
                                <input type="url" class="form-control" name="job_portal_link"
                                    value="<%= settings.job_portal_link %>">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Website Link</label>
                                <input type="url" class="form-control" name="website_link"
                                    value="<%= settings.website_link %>">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Form submission
    document.getElementById('settingsForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData(this);

        try {
            const response = await fetch(`${BASE_URL}/api/permissions/settings/update`, {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                showAlert('Settings updated successfully');
            } else {
                showAlert(result.message, 'danger');
            }
        } catch (error) {
            showAlert('Error updating settings', 'danger');
        }
    });
</script>