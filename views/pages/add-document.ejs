<%- include('../partials/header') %>

	<!-- Page Wrapper -->
	<div class="page-wrapper">
		<div class="content">
			<!-- Breadcrumb -->
			<div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
				<div class="my-auto mb-2">
					<h2 class="mb-1">Add Document</h2>
					<nav>
						<ol class="breadcrumb mb-0">
							<li class="breadcrumb-item">
								<a href="#"><i class="ti ti-smart-home"></i></a>
							</li>
							<li class="breadcrumb-item">
								Add Document
							</li>
						</ol>
					</nav>
				</div>
			</div>
			<!-- /Breadcrumb -->

			<div class="add-info-fieldset">
				<fieldset id="first-field-file">
					<form action="#">
						<div class="modal-body">
							<div class="row">
								<div class="col-md-4">
									<div class="mb-3">
										<label class="form-label">Project Name</label>
										<select id="projectName" name="projectName" class="form-select select2"
											required>
											<option value="">-- Select Project Name --</option>
											<% if (projectNames && projectNames.length) { %>
												<% projectNames.forEach(project=> { %>
													<option value="<%= project._id %>">
														<%= project.projectName %>
													</option>
													<% }) %>
														<% } else { %>
															<option disabled>No projects available</option>
															<% } %>
										</select>
									</div>
								</div>
								<div class="col-md-4">
									<div class="mb-3">
										<label for="department" class="form-label">Department <span
												class="text-danger">*</span></label>
										<select id="department" name="department" class="form-select select2" required>
											<option value="">-- Select Department --</option>
											<% if (departments && departments.length) { %>
												<% departments.forEach(dep=> { %>
													<option value="<%= dep._id %>">
														<%= dep.name %>
													</option>
													<% }) %>
														<% } else { %>
															<option disabled>No departments available</option>
															<% } %>
										</select>
									</div>
								</div>
								<div class="col-md-4">
									<div class="mb-3">
										<label class="form-label">Project Manager</label>
										<select id="projectManager" name="projectManager" class="form-select select2"
											required>
											<option value="">-- Select Project Manager --</option>
											<% if (users && users.length) { %>
												<% users.forEach(user=> { %>
													<option value="<%= user._id %>">
														<%= user.name %>
													</option>
													<% }) %>
														<% } else { %>
															<option disabled>No departments available</option>
															<% } %>
										</select>
									</div>
								</div>
								<div class="col-md-4">
									<div class="mb-3">
										<label class="form-label">Select Date</label>
										<div class="input-icon-end position-relative">
											<input type="text" class="form-control datetimepicker"
												placeholder="dd/mm/yyyy" value="02-05-2024">
											<span class="input-icon-addon">
												<i class="ti ti-calendar text-gray-7"></i>
											</span>
										</div>
									</div>
								</div>
								<div class="col-md-4">
									<div class="mb-3">
										<label class="form-label">Add Tags</label>
										<input type="text" class="form-control">
									</div>
								</div>
								<div class="col-md-4">
									<div class="mb-3">
										<label class="form-label">Meta Data</label>
										<div class="position-relative">
											<input type="text" class="form-control">
											<button class="border-0 fieldright_btn" data-bs-toggle="modal"
												data-bs-target="#metadata-modal">
												<img src="/img/icons/fieldbtn.png">
											</button>
										</div>
									</div>
								</div>
								<div class="col-md-12">
									<div class="mb-3">
										<label class="form-label">Description</label>
										<div class="summernote"></div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="mb-3">
										<div class="d-flex align-items-center gap-5">
											<label class="form-label mb-0">Compliance and Retention Document</label>
											<div class="form-check">
												<input class="form-check-input" type="radio" name="flexRadioDefault"
													id="flexRadioDefault4">
												<label class="form-check-label" for="flexRadioDefault4">
													Yes
												</label>
											</div>
											<div class="form-check">
												<input class="form-check-input" type="radio" name="flexRadioDefault"
													id="flexRadioDefault30" checked="">
												<label class="form-check-label" for="flexRadioDefault30">
													No
												</label>
											</div>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="mb-3">
										<div class="d-flex align-items-center gap-5">
											<label class="form-label mb-0">Enter Expriry Date</label>
											<div class="input-icon-end position-relative">
												<input type="text" class="form-control datetimepicker"
													placeholder="dd/mm/yyyy" value="02-05-2024">
												<span class="input-icon-addon">
													<i class="ti ti-calendar text-gray-7"></i>
												</span>
											</div>
										</div>
									</div>
								</div>
								<div class="col-md-12">
									<div class="mb-3">
										<label class="form-label">Leave a comment (Optional)</label>
										<input type="text" class="form-control">
									</div>
								</div>

								<div class="col-md-12">
									<label class="form-label">File Uploads</label>
									<div class="upload-box mb-3" id="uploadBox">
										<i class="ti ti-cloud-upload fa-2x text-primary mb-2"></i>
										<p class="mb-1"><strong>Click to upload file</strong> or drag and drop</p>
										<small class="text-muted">Max 10GB total storage. XLSX / ODS / CSV / PDF</small>
										<input type="file" class="form-control d-none" id="fileInput" multiple>
									</div>
									<div class="crtfoldr_row text-center my-4">
										<span class="pe-3">or</span>
										<button class="btn btn-primary rounded-pill" data-bs-toggle="modal"
											data-bs-target="#folder-modal">Create Folder</button>
									</div>
									<div id="fileList"></div>
								</div>
								<div class="col-md-12">
									<label class="form-label">Add Your Signature</label>
									<div class="signtrboxwrp mb-3">
										<div class="signbox form-control">

										</div>
										<div class="signupld">
											<input type="file" class="form-control d-none" id="fileSign">
											<button class="btn btn-primary rounded-pill" id="uploadSignBtn">Browse from
												system</button>
										</div>
									</div>
								</div>
								<div class="col-md-12">
									<div class="mb-3">
										<label class="form-label">Add Link (if any)</label>
										<input type="text" class="form-control">
									</div>
								</div>
							</div>
						</div>
						<div class="d-flex align-items-center justify-content-end">
							<button class="btn btn-primary rounded-pill" type="button"
								data-bs-target="#data-success-modal" data-bs-toggle="modal" data-bs-dismiss="modal">Add
								Document</button>
						</div>
					</form>
				</fieldset>

			</div>
		</div>

		<div class="footer mt-4 d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
			<p class="mb-0">2025 &copy; HLFPPT.</p>
			<p>Designed & Developed by <a href="javascript:void(0);" class="text-primary">Duplex services &
					Technology</a></p>
		</div>

	</div>
	<!-- /Page Wrapper -->
	<%- include('../partials/footer') %>


		<div id="metadata-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					<div class="modal-body">

						<form class="mt-4 px-3" action="#">
							<div class="mb-3">
								<label for="username" class="form-label">File Name</label>
								<input class="form-control" type="text" id="username" required=""
									placeholder="File Name">
							</div>
							<div class="mb-3">
								<label for="emailaddress" class="form-label">File description</label>
								<input class="form-control" type="text" id="emailaddress" required=""
									placeholder="Project about the new KVP app">
							</div>
							<div class="mb-3">
								<label for="password" class="form-label">File main Heading</label>
								<input type="text" class="form-control">
							</div>
							<div class="mb-3 text-center">
								<button class="btn btn-primary rounded-pill" type="submit">Create</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<!-- /Modal -->



		<div id="data-success-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modalw620">
				<div class="modal-content">
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					<div class="modal-body">
						<div class="success_mdltxt text-center">
							<div class="imgscs mb-3"><img src="/img/icons/success.png"></div>
							<div class="d-flex align-items-center justify-content-center mb-2">
								<span class="avatar rounded bg-light mb-2">
									<img src="/img/icons/fn1.png">
								</span>
								<div class="ms-2">
									<p class="fs-14 mb-1 fw-normal">Project Proposal v1 </p>
								</div>
							</div>
							<h4 class="fs-24 text-dark fw-medium mb-4">Your file Added successfully</h4>
							<p class="fs-20 fw-normal mb-4">You will be notified soon as your file gets approved </p>
							<div class="mb-3 text-center">
								<button class="btn btn-primary rounded-pill minw80" type="submit">Ok</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /Modal -->




		<script>
			const uploadBox = document.getElementById("uploadBox");
			const fileInput = document.getElementById("fileInput");
			const fileList = document.getElementById("fileList");

			// Open file dialog on click
			uploadBox.addEventListener("click", () => fileInput.click());

			// Handle file selection
			fileInput.addEventListener("change", () => handleFiles(fileInput.files));

			// Drag and drop events
			uploadBox.addEventListener("dragover", (e) => {
				e.preventDefault();
				uploadBox.classList.add("dragover");
			});

			uploadBox.addEventListener("dragleave", () => {
				uploadBox.classList.remove("dragover");
			});

			uploadBox.addEventListener("drop", (e) => {
				e.preventDefault();
				uploadBox.classList.remove("dragover");
				handleFiles(e.dataTransfer.files);
			});

			// Handle uploaded files
			function handleFiles(files) {
				[...files].forEach((file) => {
					const fileId = Date.now() + Math.random(); // unique id
					const fileItem = document.createElement("div");
					fileItem.classList.add("file-item");
					fileItem.classList.add("col-sm-5");
					fileItem.setAttribute("data-id", fileId);

					// Choose icon based on type
					let iconClass = "fa-file";
					if (file.type.includes("word")) iconClass = "fa-file-word text-primary";
					else if (file.type.includes("pdf")) iconClass = "fa-file-pdf text-danger";
					else if (file.type.includes("presentation") || file.name.endsWith(".ppt") || file.name.endsWith(".pptx")) iconClass = "fa-file-powerpoint text-warning";
					else if (file.type.includes("sheet") || file.name.endsWith(".xls") || file.name.endsWith(".xlsx")) iconClass = "fa-file-excel text-success";

					fileItem.innerHTML = `
	        <div class="file-info">
	          <i class="fa-solid ${iconClass} fa-2x"></i>
	          <div>
	            <h6 class="mb-0">${file.name}</h6>
	            <small class="text-muted">${(file.size / 1024 / 1024).toFixed(2)} MB</small>
	          </div>
	        </div>
	        <div class="file-progress">
	          <div class="progress">
	            <div class="progress-bar bg-success" role="progressbar" style="width: 0%">0%</div>
	          </div>
	        </div>
	        <button class="remove-btn"><i class="fa-solid fa-xmark"></i></button>
      `;

					fileList.appendChild(fileItem);

					// Fake progress animation
					let progress = 0;
					const interval = setInterval(() => {
						if (progress >= 100) {
							clearInterval(interval);
						} else {
							progress += 10;
							const progressBar = fileItem.querySelector(".progress-bar");
							progressBar.style.width = progress + "%";
							progressBar.textContent = progress + "%";
						}
					}, 200);

					// Remove file
					fileItem.querySelector(".remove-btn").addEventListener("click", () => {
						fileItem.remove();
					});
				});
			}
		</script>


		<script>
			const fileSign = document.getElementById('fileSign');
			const uploadSignBtn = document.getElementById('uploadSignBtn');
			const signBox = document.querySelector('.signbox');

			// Open file dialog on button click
			uploadSignBtn.addEventListener('click', () => {
				fileSign.click();
			});

			// Show preview when file is selected
			fileSign.addEventListener('change', function () {
				if (this.files && this.files[0]) {
					const reader = new FileReader();
					reader.onload = function (e) {
						signBox.innerHTML = `<img src="${e.target.result}" alt="Signature Preview" 
                              style="max-height: 100%; max-width: 100%; object-fit: contain;">`;
						uploadSignBtn.textContent = "Update Signature";
					};
					reader.readAsDataURL(this.files[0]);
				}
			});
		</script>