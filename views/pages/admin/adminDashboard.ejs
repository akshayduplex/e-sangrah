<%- include('../../partials/header') %>
    <!-- Page Wrapper -->
    <div class="page-wrapper">
        <div class="content">

            <!-- Breadcrumb -->
            <div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
                <div class="my-auto mb-2">
                    <h2 class="mb-1">Dashboard Overview</h2>
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="#"><i class="ti ti-smart-home"></i></a>
                            </li>
                            <li class="breadcrumb-item">
                                Dashboard
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">Admin</li>
                        </ol>
                    </nav>
                </div>
            </div>
            <!-- /Breadcrumb -->

            <!-- Welcome Wrap -->
            <div class="card">
                <div class="card-body d-flex align-items-center justify-content-between flex-wrap pb-1">
                    <div class="d-flex align-items-center mb-3">
                        <span class="avatar avatar-xl flex-shrink-0">
                            <img src="<%= user.profile_image || '/img/profiles/avatar-12.jpg' %>" class="rounded-circle"
                                alt="<%= name || 'User' %>">
                        </span>
                        <div class="ms-3">
                            <h3 class="mb-2">
                                <%= name || "User" %>
                            </h3>
                            <p>You have <span class="text-primary text-decoration-underline" id="pendingCount">0</span>
                                Pending Approvals
                            </p>
                        </div>
                    </div>
                    <div class="d-flex align-items-center flex-wrap mb-1">
                        <a href="#" class="btn btn-primary btn-md me-2 mb-2" data-bs-toggle="modal"
                            data-bs-target="#add_project">
                            <i class="ti ti-plus me-1"></i>Add New Document</a>
                    </div>
                </div>
            </div>
            <!-- /Welcome Wrap -->

            <div class="row">
                <div class="col-xxl-12">
                    <div class="row flex-fill">
                        <div class="col-md-3 d-flex">
                            <div class="card flex-fill dashboard-card" data-status="">
                                <div class="card-body">
                                    <h3 class="fs-32 fw-medium mb-2" id="totalDocs">0</h3>
                                    <h6 class="fs-16 fw-light text-default mb-3">Total Documents</h6>
                                    <span class="fs-12 fw-medium text-success">
                                        <span class="sm-avatar avatar rounded bg-soft-success"><i
                                                class="ti ti-trending-up"></i> </span> +10%
                                    </span>
                                    <div class="card_avtr_right">
                                        <span class="avatar rounded bg-primary mb-2">
                                            <i class="ti ti-calendar-share fs-24"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 d-flex">
                            <div class="card flex-fill dashboard-card" data-status="Approved">
                                <div class="card-body">
                                    <h3 class="fs-32 fw-medium mb-2" id="approvedDocs">0</h3>
                                    <h6 class="fs-16 fw-light text-default mb-3">Approved Documents</h6>
                                    <span class="fs-12 fw-medium text-success">
                                        <span class="sm-avatar avatar rounded bg-soft-success"><i
                                                class="ti ti-trending-up"></i> </span> +10%
                                    </span>
                                    <div class="card_avtr_right">
                                        <span class="avatar rounded bg-success mb-2">
                                            <i class="ti ti-calendar-share fs-24"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 d-flex">
                            <div class="card flex-fill dashboard-card" data-status="Pending">
                                <div class="card-body">
                                    <h3 class="fs-32 fw-medium mb-2" id="pendingDocs">0</h3>
                                    <h6 class="fs-16 fw-light text-default mb-3">Pending Documents</h6>
                                    <span class="fs-12 fw-medium text-success">
                                        <span class="sm-avatar avatar rounded bg-soft-success"><i
                                                class="ti ti-trending-up"></i> </span> +10%
                                    </span>
                                    <div class="card_avtr_right">
                                        <span class="avatar rounded bg-warning mb-2">
                                            <i class="ti ti-calendar-share fs-24"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 d-flex">
                            <div class="card flex-fill dashboard-card" data-status="Rejected">
                                <div class="card-body">
                                    <h3 class="fs-32 fw-medium mb-2" id="rejectedDocs">0</h3>
                                    <h6 class="fs-16 fw-light text-default mb-3">Rejected Documents</h6>
                                    <span class="fs-12 fw-medium text-success">
                                        <span class="sm-avatar avatar rounded bg-soft-success"><i
                                                class="ti ti-trending-up"></i> </span> +10%
                                    </span>
                                    <div class="card_avtr_right">
                                        <span class="avatar rounded bg-danger mb-2">
                                            <i class="ti ti-calendar-share fs-24"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-xxl-12">
                    <div class="row flex-fill">
                        <div class="col-md-7">
                            <div class="seprate_crdhdr">
                                <div class="dflexbtwn">
                                    <h3 class="fs-20 fw-normal">File Status</h3>
                                    <a href="#" class="fs-16 fw-normal text-primary">View All</a>
                                </div>
                            </div>
                            <div class="card flex-fill">
                                <div class="card-body p-0">
                                    <div class="flextable">
                                        <div class="flxtblhdr dflexbtwn">
                                            <h4 class="fs-16 fw-normal">File Name</h4>
                                            <h4 class="fs-16 fw-normal">File Status</h4>
                                        </div>
                                        <div class="flxtblbody">
                                            <div class="dflexbtwn mb-2">
                                                <div class="flxtblleft">
                                                    <span class="avatar rounded bg-light mb-2">
                                                        <img src="/img/icons/fn1.png">
                                                    </span>
                                                    <div class="flxtbltxt">
                                                        <p class="fs-14 mb-1 fw-normal">Dev Presentation </p>
                                                        <span class="fs-11 fw-light text-black">190KB</span>
                                                    </div>
                                                </div>
                                                <div class="flxtblright">
                                                    <p class="fs-12 fw-light text-black">Opened the file</p>
                                                </div>
                                            </div>
                                            <div class="dflexbtwn mb-2">
                                                <div class="flxtblleft">
                                                    <span class="avatar rounded bg-light mb-2">
                                                        <img src="/img/icons/fn2.png">
                                                    </span>
                                                    <div class="flxtbltxt">
                                                        <p class="fs-14 mb-1 fw-normal">Project Proposal </p>
                                                        <span class="fs-11 fw-light text-black">190KB</span>
                                                    </div>
                                                </div>
                                                <div class="flxtblright">
                                                    <p class="fs-12 fw-light text-black">Seen the file</p>
                                                </div>
                                            </div>
                                            <div class="dflexbtwn mb-2">
                                                <div class="flxtblleft">
                                                    <span class="avatar rounded bg-light mb-2">
                                                        <img src="/img/icons/fn3.png">
                                                    </span>
                                                    <div class="flxtbltxt">
                                                        <p class="fs-14 mb-1 fw-normal">Team Management </p>
                                                        <span class="fs-11 fw-light text-black">190KB</span>
                                                    </div>
                                                </div>
                                                <div class="flxtblright">
                                                    <p class="fs-12 fw-light text-black">Modified the file</p>
                                                </div>
                                            </div>
                                            <div class="dflexbtwn mb-2">
                                                <div class="flxtblleft">
                                                    <span class="avatar rounded bg-light mb-2">
                                                        <img src="/img/icons/fn4.png">
                                                    </span>
                                                    <div class="flxtbltxt">
                                                        <p class="fs-14 mb-1 fw-normal">Work Flow File </p>
                                                        <span class="fs-11 fw-light text-black">190KB</span>
                                                    </div>
                                                </div>
                                                <div class="flxtblright">
                                                    <p class="fs-12 fw-light text-black">Closed the file</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="seprate_crdhdr">
                                <div class="dflexbtwn">
                                    <h3 class="fs-20 fw-normal">Recent Activity</h3>
                                </div>
                            </div>
                            <div class="card flex-fill">
                                <div class="card-body" id="recentActivityContainer">
                                    <!-- Recent activities will load here dynamically -->
                                </div>
                            </div>

                        </div>
                        <div class="col-md-5">
                            <div class="card flex-fill">
                                <div
                                    class="card-header border-0 pb-2 d-flex align-items-center justify-content-between flex-wrap">
                                    <h5 class="fs-20 mb-2 mxw-70">Department Document Uploads type</h5>
                                    <div class="dropdown mb-2">
                                        <a href="javascript:void(0);"
                                            class="btn btn-white border btn-sm d-inline-flex align-items-center"
                                            data-bs-toggle="dropdown">
                                            <i class="ti ti-calendar me-1"></i>Today
                                        </a>
                                        <ul class="dropdown-menu dropdown-menu-end p-3">
                                            <li>
                                                <a href="javascript:void(0);" class="dropdown-item rounded-1">This
                                                    Month</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" class="dropdown-item rounded-1">This
                                                    Week</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" class="dropdown-item rounded-1">Today</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chartjs-wrapper-demo position-relative mb-4">
                                        <canvas id="department" height="400"></canvas>
                                        <div class="position-absolute text-center attendance-canvas">
                                            <p class="fs-13 mb-1">Top Management</p>
                                            <h3>22%</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Sales Overview -->
                <div class="col-xl-12">
                    <div class="card flex-fill">
                        <div class="card-header pb-2 border-0">
                            <div class="dflexbtwn">
                                <h5 class="mb-2">Department Document Uploads</h5>
                                <div class="d-flex align-items-center justify-content-between flex-wrap">
                                    <div class="d-flex align-items-center mb-1">
                                        <p class="fs-13  me-3 mb-0"><i
                                                class="ti ti-square-filled text-lblue me-2"></i>Pending Approvals</p>
                                        <p class="fs-13  me-3 mb-0"><i
                                                class="ti ti-square-filled text-lgreen me-2"></i>Approved</p>
                                        <p class="fs-13  mb-0"><i
                                                class="ti ti-square-filled me-2 text-lorange"></i>Rejected</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body pb-0">
                            <div class="d-flex align-items-center justify-content-end">
                                <!-- Department Select using Select2 -->
                                <div class="mb-2">
                                    <select id="uploadDepartment" class="form-select fs-13 select2">
                                        <option value="">-- All Departments --</option>
                                        <!-- Options will be dynamically loaded via AJAX -->
                                    </select>
                                </div>

                                <div class="dropdown mb-2">
                                    <a href="javascript:void(0);"
                                        class="btn btn-white border text-black btn btn-outline-secondary"
                                        data-bs-toggle="dropdown">
                                        <i class="ti ti-calendar me-1"></i>Today
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end p-3">
                                        <li>
                                            <a href="javascript:void(0);" class="dropdown-item rounded-1">This Month</a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);" class="dropdown-item rounded-1">This Week</a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);" class="dropdown-item rounded-1">Today</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div id="sales-income"></div>
                        </div>
                    </div>
                </div>
                <!-- /Sales Overview -->
            </div>

            <div class="row">
                <div class="seprate_crdhdr">
                    <div class="dflexbtwn">
                        <h3 class="fs-20 fw-normal">Recent Activity</h3>
                        <div class="d-flex gap-2 align-items-center">
                            <!-- Department Select using Select2 -->
                            <div class="mb-2">
                                <select id="recentActivityDepartment" class="form-select fs-13 select2">
                                    <option value="">-- Select Department --</option>
                                    <!-- Options will be dynamically loaded via AJAX -->
                                </select>
                            </div>

                            <div class="dropdown">
                                <div class="input-group">
                                    <span class="input-group-text border">Sort by:</span>
                                    <select id="recentActivitySort" class="form-select select2 text-black">
                                        <option value="updatedAt" selected>Doc type</option>
                                        <option value="createdAt">Date</option>
                                        <option value="metadata.fileName">Name</option>
                                        <option value="status">Status</option>
                                    </select>
                                </div>
                            </div>
                            <a href="/documents/list" class="fs-16 ms-4 fw-normal text-primary">View All</a>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-12 col-xl-12">
                    <div class="card flex-fill">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-nowrap mb-0">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>File Name</th>
                                            <th>Last Modified on</th>
                                            <th>Owner</th>
                                            <th>Department</th>
                                            <th>Project</th>
                                            <th>Shared with</th>
                                            <th>Tags</th>
                                            <th>Meta data</th>
                                            <th>Created on</th>
                                            <th>Description</th>
                                            <th>Remark</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Recent activity rows will be dynamically loaded via AJAX -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Projects -->
            </div>
        </div>
        <div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
            <p class="mb-0">2025 &copy; HLFPPT.</p>
            <p>Designed & Developed by <a href="javascript:void(0);" class="text-primary">Duplex services &
                    Technology</a></p>
        </div>

    </div>
    <!-- /Page Wrapper -->
    <%- include('../../partials/footer') %>
        <!-- <script>
            document.addEventListener("DOMContentLoaded", function () {
                let myDonutChart; // global chart instance

                async function loadDepartmentChart(period = 'monthly') {
                    try {
                        const response = await fetch(`http://localhost:5000/api/dashboard/uploads?period=${period}`);
                        const result = await response.json();

                        if (result.success && result.data) {
                            const chartData = result.data.chartData;
                            const ctx = document.getElementById('department').getContext('2d');

                            // Destroy previous chart to avoid duplicates
                            if (myDonutChart) myDonutChart.destroy();

                            // Create new donut chart
                            myDonutChart = new Chart(ctx, {
                                type: 'doughnut',
                                data: {
                                    labels: chartData.labels,
                                    datasets: [{
                                        label: 'Donut',
                                        data: chartData.datasets[0].data,
                                        backgroundColor: chartData.datasets[0].backgroundColor,
                                        borderWidth: 5,
                                        borderRadius: 10,
                                        borderColor: '#fff',
                                        hoverBorderWidth: 0,
                                        cutout: '63%',
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: {
                                            display: false
                                        },
                                        tooltip: {
                                            callbacks: {
                                                label: function (context) {
                                                    const idx = context.dataIndex;
                                                    const count = chartData.datasets[0].counts[idx];
                                                    const percent = chartData.datasets[0].data[idx];
                                                    return `${context.label}: ${count} documents (${percent}%)`;
                                                }
                                            }
                                        }
                                    }
                                }
                            });

                            // Update center total text
                            const total = chartData.total;
                            document.querySelector('.attendance-canvas h3').textContent = `${total}%`;
                        }
                    } catch (err) {
                        console.error("Error loading chart data:", err);
                    }
                }

                // Bind chart dropdown
                const chartDropdownItems = document.querySelectorAll('.col-md-5 .dropdown-menu a.dropdown-item');
                chartDropdownItems.forEach(item => {
                    item.addEventListener('click', function (e) {
                        e.preventDefault();
                        const text = this.textContent.trim().toLowerCase();
                        let period = 'monthly';
                        if (text === 'today') period = 'daily';
                        else if (text === 'this week') period = 'weekly';
                        else if (text === 'this month') period = 'monthly';

                        this.closest('.dropdown').querySelector('a.btn').textContent = this.textContent + ' ';
                        loadDepartmentChart(period);
                    });
                });

                // Initial load
                loadDepartmentChart('monthly');
            });
        </script> -->
        <script>// Dashboard card click handlers
            document.addEventListener('DOMContentLoaded', function () {
                const dashboardCards = document.querySelectorAll('.dashboard-card');

                dashboardCards.forEach(card => {
                    card.style.cursor = 'pointer';
                    card.addEventListener('click', function () {
                        const status = this.getAttribute('data-status');
                        redirectToDocumentsWithStatus(status);
                    });
                });
            });

            function redirectToDocumentsWithStatus(status) {
                // Construct the URL with status parameter
                const baseUrl = window.location.origin;
                let url = `${baseUrl}/documents/list`;

                // Add status parameter if not "all"
                if (status && status !== 'all') {
                    url += `?status=${encodeURIComponent(status)}`;
                }

                // Redirect to documents list page
                window.location.href = url;
            }</script>
        <script>function loadDocumentChart(department) {
                $.ajax({
                    url: "/api/documents/status-summary?period=monthly" + (department ? "&department=" + department : ""),
                    method: "GET",
                    success: function (res) {
                        var sColStacked = {
                            chart: {
                                height: 290,
                                type: 'bar',
                                stacked: true,
                                toolbar: { show: false }
                            },
                            colors: ['#197BF7', '#F15C44', '#2BB68D'],
                            plotOptions: { bar: { borderRadius: 5, borderRadiusWhenStacked: 'all', horizontal: false, endingShape: 'rounded' } },
                            series: res.data.series,
                            xaxis: {
                                categories: res.data.categories.map(m => ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][m - 1]),
                                labels: { style: { colors: '#6B7280', fontSize: '13px' } }
                            },
                            yaxis: { labels: { offsetX: -15, style: { colors: '#6B7280', fontSize: '13px' } } },
                            grid: { borderColor: '#E5E7EB', strokeDashArray: 5, padding: { left: -8 } },
                            legend: { show: false },
                            dataLabels: { enabled: false },
                            fill: { opacity: 1 },
                        };

                        if (window.documentChart) window.documentChart.destroy();
                        window.documentChart = new ApexCharts(document.querySelector("#sales-income"), sColStacked);
                        window.documentChart.render();
                    }
                });
            }

            // On department change
            $('#uploadDepartment').on('change', function () {
                const dept = $(this).val();
                loadDocumentChart(dept);
            });

            // Initial load
            loadDocumentChart();
        </script>
        <script src="/js/pages/dashboard/adminDashboard.js"></script>