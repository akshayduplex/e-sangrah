<%- include('../../partials/header') %>
    <!-- Page Wrapper -->
    <div class="page-wrapper">
        <div class="content">

            <!-- Breadcrumb -->
            <div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
                <div class="my-auto mb-2">
                    <h2 class="mb-1">Dashboard Overview</h2>
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="#"><i class="ti ti-smart-home"></i></a>
                            </li>
                            <li class="breadcrumb-item">
                                Dashboard
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">Admin</li>
                        </ol>
                    </nav>
                </div>
            </div>
            <!-- /Breadcrumb -->

            <!-- Welcome Wrap -->
            <div class="card">
                <div class="card-body d-flex align-items-center justify-content-between flex-wrap pb-1">
                    <div class="d-flex align-items-center mb-3">
                        <span class="avatar avatar-xl flex-shrink-0">
                            <img src="<%= user.profile_image || '/img/profiles/avatar-12.jpg' %>" class="rounded-circle"
                                alt="<%= name || 'User' %>">
                        </span>
                        <div class="ms-3">
                            <h3 class="mb-2">
                                <%= name || "User" %>
                            </h3>
                            <p>You have <span class="text-primary text-decoration-underline" id="pendingCount">0</span>
                                Pending Approvals
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Welcome Wrap -->

            <div class="row">
                <div class="col-xxl-12">
                    <div class="row flex-fill">
                        <div class="col-md-3 d-flex">
                            <div class="card flex-fill dashboard-card" data-status="">
                                <div class="card-body">
                                    <h3 class="fs-32 fw-medium mb-2" id="totalDocs">0</h3>
                                    <h6 class="fs-16 fw-light text-default mb-3">Total Documents</h6>
                                    <span class="fs-12 fw-medium text-success">
                                        <span class="sm-avatar avatar rounded bg-soft-success"><i
                                                class="ti ti-trending-up"></i> </span> +10%
                                    </span>
                                    <div class="card_avtr_right">
                                        <span class="avatar rounded bg-primary mb-2">
                                            <i class="ti ti-calendar-share fs-24"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 d-flex">
                            <div class="card flex-fill dashboard-card" data-status="Approved">
                                <div class="card-body">
                                    <h3 class="fs-32 fw-medium mb-2" id="approvedDocs">0</h3>
                                    <h6 class="fs-16 fw-light text-default mb-3">Approved Documents</h6>
                                    <span class="fs-12 fw-medium text-success">
                                        <span class="sm-avatar avatar rounded bg-soft-success"><i
                                                class="ti ti-trending-up"></i> </span> +10%
                                    </span>
                                    <div class="card_avtr_right">
                                        <span class="avatar rounded bg-success mb-2">
                                            <i class="ti ti-calendar-share fs-24"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 d-flex">
                            <div class="card flex-fill dashboard-card" data-status="Pending">
                                <div class="card-body">
                                    <h3 class="fs-32 fw-medium mb-2" id="pendingDocs">0</h3>
                                    <h6 class="fs-16 fw-light text-default mb-3">Pending Documents</h6>
                                    <span class="fs-12 fw-medium text-success">
                                        <span class="sm-avatar avatar rounded bg-soft-success"><i
                                                class="ti ti-trending-up"></i> </span> +10%
                                    </span>
                                    <div class="card_avtr_right">
                                        <span class="avatar rounded bg-warning mb-2">
                                            <i class="ti ti-calendar-share fs-24"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 d-flex">
                            <div class="card flex-fill dashboard-card" data-status="Rejected">
                                <div class="card-body">
                                    <h3 class="fs-32 fw-medium mb-2" id="rejectedDocs">0</h3>
                                    <h6 class="fs-16 fw-light text-default mb-3">Rejected Documents</h6>
                                    <span class="fs-12 fw-medium text-success">
                                        <span class="sm-avatar avatar rounded bg-soft-success"><i
                                                class="ti ti-trending-up"></i> </span> +10%
                                    </span>
                                    <div class="card_avtr_right">
                                        <span class="avatar rounded bg-danger mb-2">
                                            <i class="ti ti-calendar-share fs-24"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-xxl-12">
                    <div class="row flex-fill">
                        <div class="col-md-7">
                            <div class="seprate_crdhdr">
                                <div class="dflexbtwn">
                                    <h3 class="fs-20 fw-normal">File Status</h3>
                                    <a href="/files/file-status" class="fs-16 fw-normal text-primary">View All</a>
                                </div>
                            </div>
                            <div class="card flex-fill">
                                <div class="card-body p-0">
                                    <div class="flextable">
                                        <div class="flxtblhdr dflexbtwn">
                                            <h4 class="fs-16 fw-normal">File Name</h4>
                                            <h4 class="fs-16 fw-normal">User</h4>
                                            <h4 class="fs-16 fw-normal">Time</h4>
                                            <h4 class="fs-16 fw-normal">File Status</h4>
                                        </div>

                                        <!-- Dynamic content will be injected here -->
                                        <div class="flxtblbody" id="fileList"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="seprate_crdhdr">
                                <div class="dflexbtwn">
                                    <h3 class="fs-20 fw-normal">Recent Activity</h3>
                                </div>
                            </div>
                            <div class="card flex-fill">
                                <div class="card-body" id="recentActivityContainer">
                                    <!-- Recent activities will load here dynamically -->
                                </div>
                            </div>

                        </div>
                        <div class="col-md-5">
                            <div class="card flex-fill">
                                <div
                                    class="card-header border-0 pb-2 d-flex align-items-center justify-content-between flex-wrap">
                                    <h5 class="fs-20 mb-2 mxw-70">Department Document Uploads type</h5>
                                    <div class="dropdown mb-2">
                                        <a href="javascript:void(0);" id="periodDropdown"
                                            class="btn btn-white border text-black btn btn-outline-secondary"
                                            data-bs-toggle="dropdown">
                                            <i class="ti ti-calendar me-1"></i><span
                                                id="currentDocTypePeriodLabel">Today</span>
                                        </a>
                                        <ul class="dropdown-menu dropdown-menu-end p-3">
                                            <li><a href="javascript:void(0);"
                                                    class="dropdown-item dept-upload-period-option"
                                                    data-period="year">This Year</a></li>
                                            <li><a href="javascript:void(0);"
                                                    class="dropdown-item dept-upload-period-option"
                                                    data-period="month">This Month</a></li>
                                            <li><a href="javascript:void(0);"
                                                    class="dropdown-item dept-upload-period-option"
                                                    data-period="week">This Week</a></li>
                                            <li><a href="javascript:void(0);"
                                                    class="dropdown-item dept-upload-period-option"
                                                    data-period="today">Today</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chartjs-wrapper-demo position-relative mb-4">
                                        <canvas id="department" height="400"></canvas>
                                        <div class="position-absolute text-center attendance-canvas">
                                            <p class="fs-13 mb-1">Top Management</p>
                                            <h3>22%</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- Donor & Vendor Projects -->
                <div class="col-xl-12">
                    <div class="card flex-fill">
                        <div class="card-header pb-2 border-0">
                            <!-- 1st Row: Heading (Left) | Filters (Right) -->
                            <div class="d-flex justify-content-between align-items-center flex-wrap">
                                <h5 class="mb-0">Donor & Vendor Projects</h5>
                                <div class="d-flex align-items-center flex-wrap">
                                    <div class="me-2">
                                        <select id="dashboardVendor" name="dashboardVendor"
                                            class="form-select form-select-sm select2">
                                            <option value="">-- Select Vendor Name --</option>
                                        </select>
                                    </div>
                                    <div class="me-2">
                                        <select id="dashboardDonor" name="dashboardDonor"
                                            class="form-select form-select-sm select2">
                                            <option value="">-- Select Donor Name --</option>
                                        </select>
                                    </div>
                                    <div class="dropdown">
                                        <a href="javascript:void(0);" id="periodDropdown"
                                            class="btn btn-white border text-black" data-bs-toggle="dropdown">
                                            <i class="ti ti-calendar me-1"></i><span
                                                id="currentPeriodLabel">Today</span>
                                        </a>
                                        <ul class="dropdown-menu dropdown-menu-end p-3">
                                            <li><a href="javascript:void(0);"
                                                    class="dropdown-item donor-vendor-period-option"
                                                    data-period="year">This Year</a></li>
                                            <li><a href="javascript:void(0);"
                                                    class="dropdown-item donor-vendor-period-option"
                                                    data-period="month">This Month</a></li>
                                            <li><a href="javascript:void(0);"
                                                    class="dropdown-item donor-vendor-period-option"
                                                    data-period="week">This Week</a></li>
                                            <li><a href="javascript:void(0);"
                                                    class="dropdown-item donor-vendor-period-option"
                                                    data-period="today">Today</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- 2nd Row: Legend (Right) -->
                            <div class="d-flex justify-content-end align-items-center mt-2">
                                <p class="fs-13 me-3 mb-0">
                                    <i class="ti ti-square-filled text-lblue me-2"></i>Donor
                                </p>
                                <p class="fs-13 me-3 mb-0">
                                    <i class="ti ti-square-filled text-lred me-2"></i>Vendor
                                </p>
                            </div>
                        </div>

                        <!-- Chart Container -->
                        <div class="card-body pb-0">
                            <div id="donorvendorprojects" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <!-- Sales Overview -->
                <div class="col-xl-12">
                    <div class="card flex-fill">
                        <div class="card-header pb-2 border-0">
                            <div class="dflexbtwn">
                                <h5 class="mb-2">Department Document Uploads</h5>
                                <div class="d-flex align-items-center justify-content-between flex-wrap">
                                    <div class="d-flex align-items-center mb-1">
                                        <p class="fs-13  me-3 mb-0"><i
                                                class="ti ti-square-filled text-lblue me-2"></i>Pending Approvals</p>
                                        <p class="fs-13  me-3 mb-0"><i
                                                class="ti ti-square-filled text-lgreen me-2"></i>Approved</p>
                                        <p class="fs-13  mb-0"><i
                                                class="ti ti-square-filled me-2 text-lorange"></i>Rejected</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body pb-0">
                            <div class="d-flex align-items-center justify-content-end">
                                <!-- Department Select using Select2 -->
                                <div class="mb-2">
                                    <select id="uploadDepartment" class="form-select fs-13 select2">
                                        <option value="">-- All Departments --</option>
                                        <!-- Options will be dynamically loaded via AJAX -->
                                    </select>
                                </div>
                                <div class="dropdown mb-2">
                                    <a href="javascript:void(0);" id="DocTypeperiodDropdown"
                                        class="btn btn-white border text-black btn btn-outline-secondary"
                                        data-bs-toggle="dropdown">
                                        <i class="ti ti-calendar me-1"></i><span
                                            id="currentDocTypePeriodLabel">Today</span>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end p-3">
                                        <li><a href="javascript:void(0);" class="dropdown-item period-option"
                                                data-period="year">This Year</a></li>
                                        <li><a href="javascript:void(0);" class="dropdown-item period-option"
                                                data-period="month">This Month</a></li>
                                        <li><a href="javascript:void(0);" class="dropdown-item period-option"
                                                data-period="week">This Week</a></li>
                                        <li><a href="javascript:void(0);" class="dropdown-item period-option"
                                                data-period="today">Today</a></li>
                                    </ul>
                                </div>

                            </div>
                            <div id="sales-income" style="height: 290px;"></div>
                        </div>
                    </div>
                </div>
                <!-- /Sales Overview -->
            </div>

            <div class="row">
                <div class="seprate_crdhdr">
                    <div class="dflexbtwn">
                        <h3 class="fs-20 fw-normal">Recent Activity</h3>
                        <div class="d-flex gap-2 align-items-center">
                            <!-- Department Select using Select2 -->
                            <div class="mb-2">
                                <select id="recentActivityDepartment" class="form-select fs-13 select2">
                                    <option value="">-- Select Department --</option>
                                    <!-- Options will be dynamically loaded via AJAX -->
                                </select>
                            </div>

                            <div class="dropdown">
                                <div class="input-group">
                                    <span class="input-group-text border">Sort by:</span>
                                    <select id="recentActivitySort" class="form-select select2 text-black">
                                        <option value="updatedAt" selected>Doc type</option>
                                        <option value="createdAt">Date</option>
                                        <option value="metadata.fileName">Name</option>
                                        <option value="status">Status</option>
                                    </select>
                                </div>
                            </div>
                            <a href="/documents/list" class="fs-16 ms-4 fw-normal text-primary">View All</a>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-12 col-xl-12">
                    <div class="card flex-fill">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-nowrap mb-0">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>File Name</th>
                                            <th>Last Modified on</th>
                                            <th>Owner</th>
                                            <th>Department</th>
                                            <th>Project</th>
                                            <th>Shared with</th>
                                            <th>Tags</th>
                                            <th>Meta data</th>
                                            <th>Created on</th>
                                            <th>Description</th>
                                            <th>Remark</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Recent activity rows will be dynamically loaded via AJAX -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Projects -->
            </div>
        </div>
        <div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
            <p class="mb-0">2025 &copy; HLFPPT.</p>
            <p>Designed & Developed by <a href="javascript:void(0);" class="text-primary">Duplex services &
                    Technology</a></p>
        </div>

    </div>
    <!-- /Page Wrapper -->
    <%- include('../../partials/footer') %>
        <script>
            async function loadDonorVendorProjects() {
                const donorId = document.getElementById("dashboardDonor").value;
                const vendorId = document.getElementById("dashboardVendor").value;
                const period = document.getElementById("currentPeriodLabel").dataset.period || "month";

                const response = await fetch(`/api/dashboard/donorVendorProjects?donorId=${donorId}&vendorId=${vendorId}&period=${period}`);
                const result = await response.json();

                if (!result.success) return;

                const data = result.data;

                const categories = data.map(item => item.projectType);
                const donorSeries = data.map(item => item.donorCount);
                const vendorSeries = data.map(item => item.vendorCount);

                const options = {
                    series: [
                        { name: "Donor", data: donorSeries },
                        { name: "Vendor", data: vendorSeries }
                    ],
                    chart: { type: 'bar', height: 400 },
                    plotOptions: {
                        bar: {
                            horizontal: false,
                            columnWidth: '55%',
                            borderRadius: 5,
                            borderRadiusApplication: 'end'
                        },
                    },
                    dataLabels: { enabled: false },
                    xaxis: { categories },
                    yaxis: { title: { text: "Number of Projects" } },
                    colors: ['#008FFB', '#FF4560']
                };

                const chartEl = document.querySelector("#donorvendorprojects");
                chartEl.innerHTML = ""; // Clear previous chart

                const chart = new ApexCharts(chartEl, options);
                chart.render();
            }

            // Load on page load
            document.addEventListener("DOMContentLoaded", loadDonorVendorProjects);

            // Reload chart when filters change
            document.getElementById("dashboardVendor").addEventListener("change", loadDonorVendorProjects);
            document.getElementById("dashboardDonor").addEventListener("change", loadDonorVendorProjects);

            // Dropdown period event
            document.querySelectorAll(".period-option").forEach(el => {
                el.addEventListener("click", e => {
                    const period = e.target.dataset.period;
                    document.getElementById("currentPeriodLabel").textContent = e.target.textContent;
                    document.getElementById("currentPeriodLabel").dataset.period = period;
                    loadDonorVendorProjects();
                });
            });
        </script>

        <script>// Dashboard card click handlers
            document.addEventListener('DOMContentLoaded', function () {
                const dashboardCards = document.querySelectorAll('.dashboard-card');

                dashboardCards.forEach(card => {
                    card.style.cursor = 'pointer';
                    card.addEventListener('click', function () {
                        const status = this.getAttribute('data-status');
                        redirectToDocumentsWithStatus(status);
                    });
                });
            });

            function redirectToDocumentsWithStatus(status) {
                // Construct the URL with status parameter
                const baseUrl = window.location.origin;
                let url = `${baseUrl}/documents/list`;

                // Add status parameter if not "all"
                if (status && status !== 'all') {
                    url += `?status=${encodeURIComponent(status)}`;
                }

                // Redirect to documents list page
                window.location.href = url;
            }</script>
        <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
        <script>
            const ctx = document.getElementById('donorvendorprojects').getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [
                        'Healthcare',
                        'Education',
                        'Infrastructure',
                        'NHAI',
                        'Training',
                        'DMS',
                        'TMS',
                        'KVP',
                        'VMS'
                    ],
                    datasets: [
                        {
                            label: 'Donor',
                            backgroundColor: '#007bff',
                            borderColor: '#007bff',
                            borderWidth: 1,
                            data: [25, 10, 17, 5, 4, 8, 20, 11, 10],
                        },
                        {
                            label: 'Vendor',
                            backgroundColor: '#dc3545',
                            borderColor: '#dc3545',
                            borderWidth: 1,
                            data: [18, 7, 12, 4, 16, 10, 2, 12, 25],
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Projects'
                            },
                            ticks: {
                                stepSize: 5
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: ''
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 15,
                                padding: 10
                            }
                        },
                        title: {
                            display: false
                        }
                    }
                }
            });
        </script>
        <script src="/js/pages/dashboard/adminDashboard.js"></script>