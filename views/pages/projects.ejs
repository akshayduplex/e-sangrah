<%- include('../partials/header') %>

    <div class="page-wrapper">
        <div class="content">
            <!-- Breadcrumb -->
            <div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
                <div class="my-auto mb-2">
                    <h2 class="mb-1">Project Management</h2>
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="/dashboard"><i class="ti ti-smart-home"></i> Dashboard</a>
                            </li>
                            <li class="breadcrumb-item active">Projects</li>
                        </ol>
                    </nav>
                </div>
                <div class="ms-auto mb-2">
                    <form action="/api/projects/sync" method="POST" id="sync-form">
                        <button type="submit" id="sync-button" class="btn btn-primary btn-md">
                            <i class="ti ti-sync me-1"></i> Sync Now
                        </button>
                    </form>
                    <small class="ms-2">Last sync: <span id="last-sync-time">
                            <%= new Date().toLocaleString() %>
                        </span></small>
                </div>
            </div>

            <!-- Flash Messages -->
            <% if (messages.success && messages.success.length> 0) { %>
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <%= messages.success[0] %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                <% } %>

                    <% if (messages.error && messages.error.length> 0) { %>
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <%= messages.error[0] %>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        <% } %>

                            <!-- Projects Table -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="card flex-fill">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Projects List</h5>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Project Name</th>
                                                            <th>Logo</th>
                                                            <th>In Charge</th>
                                                            <th>Managers</th>
                                                            <th>Start Date</th>
                                                            <th>End Date</th>
                                                            <th>Duration</th>
                                                            <th>Status</th>
                                                            <th>Last Updated</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="projects-table">
                                                        <% if (projects && projects.length> 0) { %>
                                                            <% projects.forEach((project)=> { %>
                                                                <tr>
                                                                    <td><strong>
                                                                            <%= project.title %>
                                                                        </strong></td>
                                                                    <td>
                                                                        <% if (project.logo) { %>
                                                                            <img src="<%= project.logo %>" alt="Logo"
                                                                                width="40" height="40" class="rounded">
                                                                            <% } else { %>
                                                                                <span class="text-muted">No logo</span>
                                                                                <% } %>
                                                                    </td>
                                                                    <td>
                                                                        <% if (project.in_charge_list &&
                                                                            project.in_charge_list.length> 0) { %>
                                                                            <ul class="list-unstyled mb-0">
                                                                                <%
                                                                                    project.in_charge_list.forEach((emp)=>
                                                                                    { %>
                                                                                    <li><small>
                                                                                            <%= emp.emp_name %> (<%=
                                                                                                    emp.emp_code %>)
                                                                                        </small></li>
                                                                                    <% }) %>
                                                                            </ul>
                                                                            <% } else { %>
                                                                                <span class="text-muted">Not
                                                                                    assigned</span>
                                                                                <% } %>
                                                                    </td>
                                                                    <td>
                                                                        <% if (project.manager_list &&
                                                                            project.manager_list.length> 0) { %>
                                                                            <ul class="list-unstyled mb-0">
                                                                                <% project.manager_list.forEach((emp)=>
                                                                                    { %>
                                                                                    <li><small>
                                                                                            <%= emp.emp_name %> (<%=
                                                                                                    emp.emp_code %>)
                                                                                        </small></li>
                                                                                    <% }) %>
                                                                            </ul>
                                                                            <% } else { %>
                                                                                <span class="text-muted">Not
                                                                                    assigned</span>
                                                                                <% } %>
                                                                    </td>
                                                                    <td>
                                                                        <% if (project.start_date) { %>
                                                                            <%= project.start_date.toLocaleDateString()
                                                                                %>
                                                                                <% } else { %>
                                                                                    <span class="text-muted">N/A</span>
                                                                                    <% } %>
                                                                    </td>
                                                                    <td>
                                                                        <% if (project.end_date) { %>
                                                                            <%= project.end_date.toLocaleDateString() %>
                                                                                <% } else { %>
                                                                                    <span class="text-muted">N/A</span>
                                                                                    <% } %>
                                                                    </td>
                                                                    <td>
                                                                        <%= project.duration || 'N/A' %>
                                                                    </td>
                                                                    <td>
                                                                        <span class="badge bg-<%= 
                                                        project.status === 'Active' ? 'success' : 
                                                        project.status === 'Completed' ? 'primary' : 
                                                        project.status === 'Pending' ? 'warning' : 'secondary' 
                                                    %>">
                                                                            <%= project.status %>
                                                                        </span>
                                                                    </td>
                                                                    <td>
                                                                        <small class="text-muted">
                                                                            <%= project.updated_at ?
                                                                                project.updated_at.toLocaleString()
                                                                                : 'N/A' %>
                                                                        </small>
                                                                    </td>
                                                                </tr>
                                                                <% }) %>
                                                                    <% } else { %>
                                                                        <tr>
                                                                            <td colspan="9" class="text-center py-4">
                                                                                <div class="text-muted">
                                                                                    <i
                                                                                        class="ti ti-info-circle fs-1"></i>
                                                                                    <p class="mt-2">No projects found
                                                                                    </p>
                                                                                    <p>Click the Sync button to fetch
                                                                                        data from the API</p>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        <% } %>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
        </div>

        <!-- Footer -->
        <div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
            <p class="mb-0">2025 &copy; HLFPPT.</p>
            <p>Designed & Developed by <a href="javascript:void(0);" class="text-primary">Duplex Services &
                    Technology</a></p>
        </div>
    </div>

    <%- include('../partials/footer') %>