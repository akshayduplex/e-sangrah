<%- include('../../partials/header') %>
    <!-- Page Wrapper -->
    <div class="page-wrapper">
        <div class="content">
            <!-- Breadcrumb -->
            <div class="d-flex align-items-center justify-content-between page-breadcrumb mb-3">
                <div class="my-auto mb-2">
                    <h2 class="mb-1">DMS Project Files</h2>
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="#"><i class="ti ti-smart-home"></i></a>
                            </li>
                            <li class="breadcrumb-item">
                                DMS Project Files
                            </li>
                        </ol>
                    </nav>
                </div>
                <div class="rtbtn">
                    <a href="add-document.php" class="btn btn-primary btn-lg rounded-pill me-2 mb-2">
                        <i class="ti ti-plus me-1"></i>Add New Project
                    </a>
                </div>
            </div>
            <!-- /Breadcrumb -->

            <div class="row">
                <div class="seprate_crdhdr mb-4">
                    <div class="d-flex gap-2 align-items-center">
                        <div class="dropdown">
                            <a href="javascript:void(0);"
                                class="dropdown-toggle border text-black btn btn-outline-secondary fs-13 me-2"
                                data-bs-toggle="dropdown">
                                Select Department
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end p-3">
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item rounded-1">UI/UX Designer</a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item rounded-1">HR Manager</a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item rounded-1">Junior Tester</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-12 col-xl-12">
                    <div class="card flex-fill">
                        <div class="card-body p-0">
                            <div class="custom-datatable-filter table-responsive">
                                <table class="table datatable">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>File Name</th>
                                            <th>Last Modified on</th>
                                            <th>Owner</th>
                                            <th>Department</th>
                                            <th>Project</th>
                                            <th>Shared with</th>
                                            <th>Tags</th>
                                            <th>Meta data</th>
                                            <th>Created on</th>
                                            <th>Description</th>
                                            <th>Remark</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="project-table-body">
                                        <!-- AJAX will populate rows here -->
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Projects -->
            </div>

        </div>

        <div class="footer mt-4 d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
            <p class="mb-0">2025 &copy; HLFPPT.</p>
            <p>Designed & Developed by <a href="javascript:void(0);" class="text-primary">Duplex services &
                    Technology</a></p>
        </div>

    </div>
    <!-- /Page Wrapper -->
    <%- include('../../partials/footer') %>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Fetch projects from API
                fetch('http://localhost:5000/api/projects', {
                    method: 'GET',
                    credentials: 'include' // sends cookies like connect.sid
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const tbody = document.getElementById('project-table-body');
                            tbody.innerHTML = ''; // clear any existing rows

                            data.projects.forEach(project => {
                                const row = document.createElement('tr');

                                row.innerHTML = `
                    <td>${project.index}</td>
                    <td>${project.fileName}</td>
                    <td>${new Date(project.lastModifiedOn).toLocaleString()}</td>
                    <td>${project.owner}</td>
                    <td>${project.department}</td>
                    <td>${project.project}</td>
                    <td>${project.sharedWith || '-'}</td>
                    <td>${project.tags}</td>
                    <td>
                        Start: ${new Date(project.metaData.startDate).toLocaleDateString()}<br>
                        End: ${new Date(project.metaData.endDate).toLocaleDateString()}<br>
                        Duration: ${project.metaData.duration} days
                    </td>
                    <td>${new Date(project.createdOn).toLocaleString()}</td>
                    <td>${project.description}</td>
                    <td>${project.remark || '-'}</td>
                    <td>${project.status}</td>
                `;

                                tbody.appendChild(row);
                            });
                        } else {
                            console.error('Failed to fetch projects:', data.message);
                        }
                    })
                    .catch(error => console.error('Error fetching projects:', error));
            });
        </script>