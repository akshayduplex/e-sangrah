<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>File Preview - <%= file ? file.originalName : 'No File' %>
    </title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .file-container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .preview-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .download-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #007bff;
            color: #fff;
            text-decoration: none;
            border-radius: 4px;
        }

        .download-btn:hover {
            background-color: #0056b3;
        }

        img {
            max-width: 100%;
            max-height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        h4 {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="file-container">
        <div class="file-preview">
            <% if (file && file.fileUrl) { %>

                <% if (file.fileType.isPDF) { %>
                    <iframe src="<%= file.fileUrl %>" class="preview-iframe"
                        title="PDF Preview of <%= file.originalName %>">
                        <p>Your browser does not support PDFs.
                            <a href="<%= file.fileUrl %>" download>Download the PDF</a> instead.
                        </p>
                    </iframe>

                    <% } else if (file.fileType.isWord || file.fileType.isExcel || file.fileType.isPowerPoint) { %>
                        <div style="position: relative; height: 600px;">
                            <iframe
                                src="https://view.officeapps.live.com/op/embed.aspx?src=<%= encodeURIComponent(file.fileUrl) %>"
                                class="preview-iframe" style="width: 100%; height: 100%; border: none;"
                                title="Office Preview of <%= file.originalName %>"></iframe>
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            <em>Powered by Microsoft Office Online Viewer</em>
                        </div>

                        <% } else if (file.fileType.isText) { %>
                            <iframe src="<%= file.fileUrl %>" class="preview-iframe"
                                title="Text Preview of <%= file.originalName %>"></iframe>

                            <% } else if (file.originalName.match(/\.(jpg|jpeg|png|gif|webp)$/i)) { %>
                                <div style="text-align: center;">
                                    <img src="<%= file.fileUrl %>" alt="<%= file.originalName %>">
                                </div>

                                <% } else { %>
                                    <div style="text-align: center; padding: 40px;">
                                        <h4>Preview not available</h4>
                                        <p>This file type (.<%= file.fileType.extension %>) cannot be previewed in the
                                                browser.</p>
                                        <a href="<%= file.fileUrl %>" class="download-btn"
                                            download="<%= file.originalName %>">Download File</a>
                                    </div>
                                    <% } %>

                                        <% } else { %>
                                            <div style="text-align:center; padding: 40px;">
                                                <h4>File not available</h4>
                                                <% if (expiredMessage) { %>
                                                    <p>
                                                        <%= expiredMessage %>
                                                    </p>
                                                    <% } else { %>
                                                        <p>The file could not be loaded.</p>
                                                        <% } %>
                                            </div>
                                            <% } %>
        </div>
    </div>
</body>

</html>